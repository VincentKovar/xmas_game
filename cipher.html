<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dynamic Cipher Wheel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Roboto Mono', monospace;
      background-color: #1a1a1a;
    }
    .ring {
      position: absolute;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      touch-action: none;
    }
    .letter {
      position: absolute;
      transform-origin: center;
      font-weight: bold;
      text-shadow: 1px 1px 2px #000;
    }
    #arrow {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 20px solid red;
      z-index: 10;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 text-white">

  <h1 class="text-3xl font-bold text-green-400 mb-4">Dynamic Cipher Wheel</h1>
  <div class="relative" style="width: 300px; height: 300px;">
    <div id="arrow"></div>
    <div id="outerRing" class="ring w-full h-full border-4 border-green-500 bg-gray-800 text-green-300"></div>
    <div id="innerRing" class="ring w-4/5 h-4/5 border-4 border-red-500 bg-gray-900 text-red-400 cursor-grab active:cursor-grabbing" style="transition: transform 0.05s linear;"></div>
  </div>

  <div class="mt-8 w-full max-w-lg">
    <label for="inputText" class="block text-sm text-gray-400 mb-2">Plaintext Input:</label>
    <textarea id="inputText" rows="3" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white resize-none"></textarea>

    <label for="outputText" class="block text-sm text-green-400 mt-4 mb-2">Encoded Output:</label>
    <textarea id="outputText" rows="3" readonly class="w-full p-3 bg-gray-700 border border-green-500 rounded-lg text-white resize-none"></textarea>
  </div>

  <script>
    const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const outerRing = document.getElementById('outerRing');
    const innerRing = document.getElementById('innerRing');
    const inputText = document.getElementById('inputText');
    const outputText = document.getElementById('outputText');

    let outerRotation = 0;
    let innerRotation = 0;
    let draggingRing = null;
    let startAngle = 0;
    let startRotation = 0;

    function createLetters(ring, color) {
      const radius = ring.offsetWidth / 2;
      for (let i = 0; i < 26; i++) {
        const angle = i * (360 / 26);
        const letter = document.createElement('div');
        letter.textContent = alphabet[i];
        letter.className = 'letter';
        const x = radius + radius * Math.sin(angle * Math.PI / 180);
        const y = radius - radius * Math.cos(angle * Math.PI / 180);
        letter.style.left = `${x}px`;
        letter.style.top = `${y}px`;
        letter.style.color = color;
        letter.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;
        ring.appendChild(letter);
      }
    }

    function getAngle(clientX, clientY, ring) {
      const rect = ring.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      const deltaX = clientX - centerX;
      const deltaY = clientY - centerY;
      let angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);
      return (angle + 90 + 360) % 360;
    }

    function updateRotation(ring, rotation) {
      ring.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
    }

    function encodeText() {
      const offset = Math.round((outerRotation - innerRotation) / (360 / 26)) % 26;
      const input = inputText.value.toUpperCase();
      let output = '';
      for (let char of input) {
        const index = alphabet.indexOf(char);
        if (index === -1) {
          output += char;
        } else {
          const mappedIndex = (index + offset + 26) % 26;
          output += alphabet[mappedIndex];
        }
      }
      outputText.value = output;
    }

    function handleStart(e, ring) {
      draggingRing = ring;
      startAngle = getAngle(e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY, ring);
      startRotation = ring === outerRing ? outerRotation : innerRotation;
    }

    function handleMove(e) {
      if (!draggingRing) return;
      const currentAngle = getAngle(e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY, draggingRing);
      let delta = currentAngle - startAngle;
      if (delta > 180) delta -= 360;
      if (delta < -180) delta += 360;
      const newRotation = startRotation + delta;
      if (draggingRing === outerRing) {
        outerRotation = newRotation;
        updateRotation(outerRing, outerRotation);
      } else {
        innerRotation = newRotation;
        updateRotation(innerRing, innerRotation);
      }
      encodeText();
    }

    function handleEnd() {
      draggingRing = null;
    }

    window.onload = () => {
      createLetters(outerRing, 'green');
      createLetters(innerRing, 'red');
      outerRing.style.left = '50%';
      outerRing.style.top = '50%';
      innerRing.style.left = '50%';
      innerRing.style.top = '50%';
      updateRotation(outerRing, outerRotation);
      updateRotation(innerRing, innerRotation);
      inputText.addEventListener('input', encodeText);

      // Mouse
      outerRing.addEventListener('mousedown', e => handleStart(e, outerRing));
      innerRing.addEventListener('mousedown', e => handleStart(e, innerRing));
      window.addEventListener('mousemove', handleMove);
      window.addEventListener('mouseup', handleEnd);

      // Touch
      outerRing.addEventListener('touchstart', e => handleStart(e, outerRing));
      innerRing.addEventListener('touchstart', e => handleStart(e, innerRing));
      window.addEventListener('touchmove', handleMove);
      window.addEventListener('touchend', handleEnd);
    };
  </script>

</body>
</html>
